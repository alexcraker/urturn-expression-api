<form class="form">
  <div>
    Give your own score:
    <input type="radio" value="1" class="star" name="star"/>
    <input type="radio" value="2" class="star" name="star"/>
    <input type="radio" value="3" class="star" name="star"/>
    <input type="radio" value="4" class="star" name="star"/>
    <input type="radio" value="5" class="star" name="star"/>
  </div>
  <div><textarea rows="5" cols="40" class="input-comment"></textarea></div>
  <div class="score">score: <span class="score-value"></span></div>
  <ul class="comments"></ul>
</form>

<script>
UT.Expression.ready(function(post){
  var stars = post.node.querySelectorAll('.star');
  var votes = post.collection('votes');
  var comment = ""
  resize();
  displayScore();
  latestComment();
  var myVote = {};
  for (var i = stars.length - 1; i >= 0; i--) {
    stars[i].onclick = function(event){
      var score = parseInt(event.target.value, 10);
      myVote.note = score;
      votes.setUserItem(myVote);
      post.save();
      displayScore();
      console.log("New score is " + score + " and the new average is " + votes.average('note'));
    }
  };
  post.node.querySelector('.input-comment').onchange = function(event){
    var text = event.target.value
    myVote.comment = text;
    votes.setUserItem(myVote);
    post.save();
    latestComment();
  };

  function displayScore(){
    post.node.querySelector('.score-value').innerHTML = votes.average('note');
  }
  function latestComment(){
    votes.find('recent', function(items){
      console.log('received recent items', items);
      var list = '';
      for(var i = 0; i < items.length; i++){
        list += '<li class="comment">' + items[i].comment + '</li>';
      }
      post.node.querySelector('.comments').innerHTML = list;
      resize();
    });
  }
  function resize(){
    post.resize({height: post.node.querySelector('form').offsetHeight});
  }
});
</script>