("ontouchstart"in window||"onmsgesturechange"in window)&&(document.querySelector("html").className=document.querySelector("html").className+" touch","undefined"!=typeof FastClick&&window.addEventListener("load",function(){new FastClick(document.body)},!1)),window.addEventListener("message",function(e){try{msgObj=JSON.parse(e.data)}catch(t){console&&console.error&&console.error("receive invalid message",e.data,t.message),msgObj={}}UT.Expression._dispatch(msgObj)},!1),UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},UT.UUID=UT.uuid,UT.Collection=function(e){this.length=0,this.name=null,this.setUserItem=function(e){if(!i)throw o.authenticate(),"ArgumentError: no currentUserId defined";return this.setItem(i,e)},this.getUserItem=function(){return i?this.getItem(i):void 0};var t=function(e,t){if(!e)throw"invalid key: "+e;if(-1!=f.indexOf(e))throw"reserved key: "+e;var n=g(e,t),i=null;return e&&(i=this.getItem(e)),p(i,n),!i||null!==n&&void 0!==n?!i&&n?(d++,c.push(e),a[e]=n):a[e]=n:(c.splice(c.indexOf(e),1),d--,delete a[e]),t&&(t._key=e),-1==l.indexOf(e)&&l.push(e),this.length=c.length,t};this.setItem=t;var n=function(e,t){if(!e)return null;var n=a[e];return void 0===n?-1===u.indexOf(e)&&void 0!==this[e]?this[e]:t:"literal"==n._type?n.value:n};this.getItem=n,this.key=function(e){return e>=c.length?null:c[e]},this.average=function(e){return s[e]?s[e].average:void 0},this.sum=function(e){return s[e]?s[e].sum:void 0},this.count=function(e){if(!e)return d;if(s[e])return s[e]?s[e].count:void 0},this.toString=function(){return'<Collection @name="'+this.name+'">'},this.save=function(){x.apply(this);var e={};if(l.length>0){for(var t=0;l.length>t;t++)e[l[t]]=a[l[t]];o.save(this.name,e),l=[]}},this.getCurrentData=function(){var e={name:this.name,count:d,definition:r.definition,operations:[],items:[]};if(r.operations)for(var t=0;r.operations.length>t;t++){var n={operation:r.operations[t].operation,field:r.operations[t].field};h[n.operation].toJsonData(s[n.field],n),e.operations.push(n)}for(var i in a){var o=a[i];o._key=i,e.items.push(o)}return e},this.refresh=function(e){m.call(this,{currentUserId:i,delegate:o,data:e})};var i,o,r,a,s,c,l,u,d,f=["refresh","setItem","getItem","count","sum","key","getUserItem","setUserItem","average","toString","size","length","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],h={_transfer:function(e,t){for(var n=Array.prototype.slice.call(arguments,2),i=n.length-1;i>=0;i--)t[n[i]]=e[n[i]]},average:{fromJsonData:function(e,t){void 0===t.average||void 0===t.average_count?(e.average=-1,e.average_count=0):h._transfer(t,e,"average","average_count")},toJsonData:function(e,t){h._transfer(e,t,"average","average_count")},recompute:function(e,t,n,i){var o=e.average_count;n&&void 0!==n[t.field]&&(e.average=(e.average*o-n[t.field])/parseFloat(o-1),o--),i&&void 0!==i[t.field]&&(e.average=(e.average*o+i[t.field])/parseFloat(o+1),o++),e.average_count=o}},count:{fromJsonData:function(e,t){void 0===t.count?e.count=0:h._transfer(t,e,"count")},toJsonData:function(e,t){h._transfer(e,t,"count")},recompute:function(e,t,n,i){n&&n[t.field]&&void 0!==n[t.field]&&(e.count=e.count-1),i&&i[t.field]&&void 0!==i[t.field]&&e.count++}},sum:{fromJsonData:function(e,t){void 0===t.sum?e.sum=0:h._transfer(t,e,"sum")},toJsonData:function(e,t){h._transfer(e,t,"sum")},recompute:function(e,t,n,i){n&&n[t.field]&&void 0!==n[t.field]&&(e.sum=e.sum-n[t.field]),i&&i[t.field]&&void 0!==i[t.field]&&(e.sum=e.sum+i[t.field])}}},p=function(e,t){if(r.operations)for(var n=0;r.operations.length>n;n++){var i=r.operations[n];(t&&void 0!==t[i.field]||e&&void 0!==e[i.field])&&h[i.operation].recompute(s[i.field],i,e,t)}},g=function(e,t){if(("object"!=typeof t||Array.isArray&&Array.isArray(t))&&(t={_type:"literal",value:t}),!t)return null;sanitizedItem={_key:e};var n;if(r.definition&&(n=r.definition.fields)&&n.length>0)for(var i=0;n.length>i;i++){var o=n[i];if(t[o.name]!==void 0)if("string"==o.type)sanitizedItem[o.name]=t[o.name];else if("number"==o.type){var a=parseFloat(t[o.name]);if(isNaN(a)||!isFinite(t[o.name]))throw"TypeError: wrong value for field note";sanitizedItem[o.name]=a}else{if("boolean"!=o.type)throw"TypeError: Unkown type "+o.type;sanitizedItem[o.name]=!!t[o.name]}}else sanitizedItem=t,sanitizedItem._key=e;return sanitizedItem},m=function(e){if(!e.data)throw"ArgumentError: missing data";if(!e.data.name)throw"ArgumentError: no name in data";if(void 0===e.data.count)throw"ArgumentError: no count in data";if(s={},c=[],l=[],u=[],i=e.currentUserId,o=e.delegate,r=e.data,this.name=r.name,d=r.count,r.operations)for(var t=0;r.operations.length>t;t++){var n=r.operations[t];s[n.field]=s[n.field]||{},h[n.operation].fromJsonData(s[n.field],n)}v.call(this,r.items)},v=function(e){if(a={},e){for(var t=0;e.length>t;t++){var n=e[t],i=n._key;a[i]=n,y.call(this,i,n),c.push(i)}this.length=c.length}},y=function(e){-1==u.indexOf(e)&&-1==f.indexOf(e)&&(u.push(e),this.__defineGetter__(e,function(){return n.call(this,e)}),this.__defineSetter__(e,function(n){return t.call(this,e,n)}))},x=function(){for(var e=Object.keys(this),n=e.length-1;n>=0;n--){var i=e[n];-1==f.indexOf(i)&&-1==u.indexOf(i)&&(t.call(this,i,this[i]),y.call(this,i,this[i]))}};m.call(this,e)};var supportGetSet=function(){try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{get:t,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{set:t,enumerable:!0,configurable:!0})}}))}catch(e){throw"Simple Storage API not Supported"}};supportGetSet(),UT.CollectionStore=function(e){this.data=e.data;var t=e.delegate;t.store=this;for(var n={},i=0;this.data.length>i;i++){var o=this.data[i],r=o.name;if(!r)throw"ArgumentError: data contains unamed collections.";n[r]=new UT.Collection({data:o,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t})}this.get=function(e){return n[e]},this.set=function(e){n[e.name]=e},this.flush=function(){t.flush()},this.getCurrentData=function(){o=[];for(var e in n)o.push(n[e].getCurrentData());return o},this.refresh=function(e,n){t.refreshCollections(e,n)}};